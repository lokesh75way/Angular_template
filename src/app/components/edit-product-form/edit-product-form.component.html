<div class="loading" *ngIf="isLoading">
  <p>Loading product...</p>
</div>

<form *ngIf="!isLoading && product" #productForm="ngForm" (ngSubmit)="onSubmit()" class="edit-product-form" novalidate>
  <div class="card">
    <h3 class="title">Edit Product</h3>

    <div class="grid">
      <div class="form-group">
        <label for="name">Product Name <span class="required">*</span></label>
        <input
          id="name"
          type="text"
          name="name"
          [(ngModel)]="product.name"
          required
          minlength="3"
          maxlength="100"
          placeholder="Enter product name"
          class="form-control"
          [class.is-invalid]="productForm.submitted && productForm.form.get('name')?.invalid"
        />
        <div *ngIf="productForm.submitted && productForm.form.get('name')?.invalid" class="error">
          <span *ngIf="productForm.form.get('name')?.errors?.['required']">Product name is required</span>
          <span *ngIf="productForm.form.get('name')?.errors?.['minlength']">Minimum 3 characters required</span>
          <span *ngIf="productForm.form.get('name')?.errors?.['maxlength']">Maximum 100 characters allowed</span>
        </div>
      </div>

      <div class="form-group">
        <label for="category">Category <span class="required">*</span></label>
        <select
          id="category"
          name="category"
          [(ngModel)]="product.category"
          required
          class="form-control"
          [class.is-invalid]="productForm.submitted && productForm.form.get('category')?.invalid"
        >
          <option value="">Select a category</option>
          <option value="Electronics">Electronics</option>
          <option value="Accessories">Accessories</option>
          <option value="Cables">Cables</option>
          <option value="Software">Software</option>
          <option value="Other">Other</option>
        </select>
        <div *ngIf="productForm.submitted && productForm.form.get('category')?.invalid" class="error">
          <span *ngIf="productForm.form.get('category')?.errors?.['required']">Category is required</span>
        </div>
      </div>

      <div class="form-group">
        <label for="price">Price <span class="required">*</span></label>
        <input
          id="price"
          type="number"
          name="price"
          [(ngModel)]="product.price"
          required
          min="0"
          step="0.01"
          placeholder="0.00"
          class="form-control"
          [class.is-invalid]="productForm.submitted && productForm.form.get('price')?.invalid"
        />
        <div *ngIf="productForm.submitted && productForm.form.get('price')?.invalid" class="error">
          <span *ngIf="productForm.form.get('price')?.errors?.['required']">Price is required</span>
          <span *ngIf="productForm.form.get('price')?.errors?.['min']">Price must be greater than 0</span>
        </div>
      </div>

      <div class="form-group">
        <label for="stock">Stock Quantity <span class="required">*</span></label>
        <input
          id="stock"
          type="number"
          name="stock"
          [(ngModel)]="product.stock"
          required
          min="0"
          step="1"
          placeholder="0"
          class="form-control"
          [class.is-invalid]="productForm.submitted && productForm.form.get('stock')?.invalid"
        />
        <div *ngIf="productForm.submitted && productForm.form.get('stock')?.invalid" class="error">
          <span *ngIf="productForm.form.get('stock')?.errors?.['required']">Stock quantity is required</span>
          <span *ngIf="productForm.form.get('stock')?.errors?.['min']">Stock must be 0 or greater</span>
        </div>
      </div>

      <div class="form-group">
        <label for="rating">Rating <span class="required">*</span></label>
        <input
          id="rating"
          type="number"
          name="rating"
          [(ngModel)]="product.rating"
          required
          min="0"
          max="5"
          step="0.1"
          placeholder="0.0"
          class="form-control"
          [class.is-invalid]="productForm.submitted && productForm.form.get('rating')?.invalid"
        />
        <div *ngIf="productForm.submitted && productForm.form.get('rating')?.invalid" class="error">
          <span *ngIf="productForm.form.get('rating')?.errors?.['required']">Rating is required</span>
          <span *ngIf="productForm.form.get('rating')?.errors?.['min']">Rating must be 0 or greater</span>
          <span *ngIf="productForm.form.get('rating')?.errors?.['max']">Rating must be 5 or less</span>
        </div>
      </div>

      <div class="form-group">
        <label for="image">Image URL <span class="required">*</span></label>
        <input
          id="image"
          type="url"
          name="image"
          [(ngModel)]="product.image"
          required
          placeholder="https://example.com/image.jpg"
          class="form-control"
          [class.is-invalid]="productForm.submitted && productForm.form.get('image')?.invalid"
        />
        <div *ngIf="productForm.submitted && productForm.form.get('image')?.invalid" class="error">
          <span *ngIf="productForm.form.get('image')?.errors?.['required']">Image URL is required</span>
        </div>
      </div>
    </div>

    <div class="form-group full-width">
      <label for="description">Description <span class="required">*</span></label>
      <textarea
        id="description"
        name="description"
        [(ngModel)]="product.description"
        required
        minlength="10"
        maxlength="500"
        rows="4"
        placeholder="Enter product description"
        class="form-control"
        [class.is-invalid]="productForm.submitted && productForm.form.get('description')?.invalid"
      ></textarea>
      <div *ngIf="productForm.submitted && productForm.form.get('description')?.invalid" class="error">
        <span *ngIf="productForm.form.get('description')?.errors?.['required']">Description is required</span>
        <span *ngIf="productForm.form.get('description')?.errors?.['minlength']">Description must be at least 10 characters</span>
        <span *ngIf="productForm.form.get('description')?.errors?.['maxlength']">Description must not exceed 500 characters</span>
      </div>
    </div>

    <div class="actions">
      <button type="button" (click)="onCancel()" class="btn-secondary" [disabled]="isSubmitting">Cancel</button>
      <button type="submit" [disabled]="!productForm.valid || isSubmitting" class="btn-primary">
        {{ isSubmitting ? 'Saving...' : 'Save Product' }}
      </button>
    </div>
  </div>
</form>
